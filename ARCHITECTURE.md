# ğŸ“Š ARQUITECTURA GENERAL - CONQUISTADORES APP

## ğŸ—ï¸ Arquitectura del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENTE (Frontend)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Next.js 15 + React + Tailwind CSS / Aceternity UI      â”‚  â”‚
â”‚  â”‚  â”œâ”€ PÃ¡gina /login                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ PÃ¡gina /registro                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ Dashboard /admin                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ Auth Context Provider                                â”‚  â”‚
â”‚  â”‚  â””â”€ Protected Routes                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                     HTTPS / REST API
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EDGE FUNCTIONS (Backend)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Supabase Edge Functions (Deno Runtime)                 â”‚  â”‚
â”‚  â”‚  URL: https://dcgkzuouqeznxtfzgdil.supabase.co/...      â”‚  â”‚
â”‚  â”‚  â”œâ”€ POST /auth (login)                  âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ POST /auth/recuperar (password)     âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ GET /auth/me (usuario actual)       âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ POST /api/joven/registro (signup)   âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ GET /api/joven/cedula/:cedula       âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ GET /api/jovenes (nuevo)            â³ TODO        â”‚  â”‚
â”‚  â”‚  â”œâ”€ GET /api/jovenes/:id (nuevo)        â³ TODO        â”‚  â”‚
â”‚  â”‚  â”œâ”€ POST /api/grupos (nuevo)            â³ TODO        â”‚  â”‚
â”‚  â”‚  â””â”€ GET /api/dashboard/metrics (nuevo)  â³ TODO        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                     SUPABASE SDK
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BASE DE DATOS (PostgreSQL)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Supabase Managed PostgreSQL (South America - SÃ£o Paulo) â”‚  â”‚
â”‚  â”‚  Project: dcgkzuouqeznxtfzgdil                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ auth.users (Supabase Auth)          âœ… SETUP       â”‚  â”‚
â”‚  â”‚  â””â”€ public schema (10 tablas):                          â”‚  â”‚
â”‚  â”‚     â”œâ”€ users (linked to auth.users)     âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ jovenes (young people)           âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ grupos (groups)                  âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ mensajes_cumpleaÃ±os              âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ plantillas_mensajes              âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ versiculos (scripture)           âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ actividad_usuarios (audit)       âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ configuracion_sistema            âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â”œâ”€ historial_eliminaciones          âœ… CREATED     â”‚  â”‚
â”‚  â”‚     â””â”€ notificaciones                   âœ… CREATED     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Functions (Triggers):                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ handle_new_user()                   âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ check_cedula_unique()               âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ check_valid_age()                   âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ check_valid_celular()               âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ check_all_consents()                âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ log_activity()                      âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â”œâ”€ log_deletion()                      âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚  â””â”€ update_ultima_sesion()              âœ… DEPLOYED    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Ãndices: 30+ (OptimizaciÃ³n)            âœ… CREATED     â”‚  â”‚
â”‚  â”‚  RLS Policies: Enabled on all tables    âœ… SECURED     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Usuario abre app                                    â”‚
â”‚     â”œâ”€ Frontend carga Auth Context                      â”‚
â”‚     â””â”€ Verifica si hay access_token en localStorage    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Si NO hay token:                                    â”‚
â”‚     â”œâ”€ Redirect a /login                                â”‚
â”‚     â””â”€ Usuario completa formulario                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. POST /auth (Backend)                                â”‚
â”‚     â”œâ”€ Email + Password                                 â”‚
â”‚     â”œâ”€ ValidaciÃ³n bÃ¡sica                                â”‚
â”‚     â””â”€ Llamada a Supabase Auth                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Supabase Auth                                       â”‚
â”‚     â”œâ”€ Verifica email/password en auth.users            â”‚
â”‚     â”œâ”€ Genera JWT token (3600 segundos)                 â”‚
â”‚     â””â”€ Retorna access_token + refresh_token            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Frontend recibe tokens                              â”‚
â”‚     â”œâ”€ access_token â†’ localStorage                      â”‚
â”‚     â”œâ”€ refresh_token â†’ httpOnly cookie                  â”‚
â”‚     â””â”€ Redirect a /dashboard                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. En cada request protegido                           â”‚
â”‚     â”œâ”€ Frontend envÃ­a: Authorization: Bearer {token}    â”‚
â”‚     â”œâ”€ Backend valida JWT                               â”‚
â”‚     â””â”€ Si vÃ¡lido: acceso a recurso                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Flujo de Registro PÃºblico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Usuario abre /registro (sin autenticaciÃ³n)          â”‚
â”‚     â”œâ”€ Formulario con 20+ campos                        â”‚
â”‚     â””â”€ 4 checkboxes de consentimiento                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Usuario completa formulario                         â”‚
â”‚     â”œâ”€ Mientras escribe cÃ©dula: GET /cedula/:cedula     â”‚
â”‚     â”œâ”€ Valida edad: 12-35 aÃ±os                          â”‚
â”‚     â”œâ”€ Valida celular: +57XXXXXXXXXX                    â”‚
â”‚     â””â”€ Marca checkboxes (obligatorio)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Usuario hace click en REGISTRAR                     â”‚
â”‚     â”œâ”€ Frontend validaciÃ³n final (Zod)                  â”‚
â”‚     â””â”€ POST /api/joven/registro                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Backend valida datos (nuevamente)                   â”‚
â”‚     â”œâ”€ ValidaciÃ³n de email (RFC)                        â”‚
â”‚     â”œâ”€ ValidaciÃ³n de cÃ©dula (8-10 dÃ­gitos)              â”‚
â”‚     â”œâ”€ ValidaciÃ³n de edad (12-35)                       â”‚
â”‚     â”œâ”€ ValidaciÃ³n de celular (+57)                      â”‚
â”‚     â”œâ”€ ValidaciÃ³n de consentimientos (4/4)              â”‚
â”‚     â””â”€ ValidaciÃ³n de unicidad (UNIQUE constraints)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Si validaciones OK: INSERT en DB                    â”‚
â”‚     â”œâ”€ INSERT en tabla jovenes                          â”‚
â”‚     â”œâ”€ INSERT en tabla actividad_usuarios (log)         â”‚
â”‚     â””â”€ Email de bienvenida (future)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Response (201 Created)                              â”‚
â”‚     â”œâ”€ Status: success                                  â”‚
â”‚     â”œâ”€ Mensaje de Ã©xito                                 â”‚
â”‚     â”œâ”€ Datos del joven registrado                       â”‚
â”‚     â””â”€ ConfirmaciÃ³n en frontend                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Seguridad Implementada

### Multicapa (Defense in Depth)

```
NIVEL 1: Frontend
â”œâ”€ ValidaciÃ³n de input (Zod)
â”œâ”€ CSRF tokens
â””â”€ No guardar passwords

NIVEL 2: API Edge Function
â”œâ”€ ValidaciÃ³n de entrada
â”œâ”€ SanitizaciÃ³n de datos
â”œâ”€ Rate limiting (por implementar)
â””â”€ CORS headers

NIVEL 3: PostgreSQL
â”œâ”€ ValidaciÃ³n de constraints
â”œâ”€ Prepared statements
â”œâ”€ Triggers de auditorÃ­a
â””â”€ Row Level Security (RLS)

NIVEL 4: Supabase Auth
â”œâ”€ JWT tokens firmados
â”œâ”€ Password hashing (bcrypt)
â”œâ”€ Refresh token rotation
â””â”€ Email verification (por implementar)
```

---

## ğŸ“Š Tablas de Base de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users (Usuarios del sistema)                               â”‚
â”œâ”€ id (PK, FK to auth.users)                                  â”‚
â”œâ”€ email (UNIQUE)                                              â”‚
â”œâ”€ nombre_completo                                             â”‚
â”œâ”€ telefono                                                    â”‚
â”œâ”€ rol (admin, lider, usuario, visitante)                     â”‚
â”œâ”€ estado (activo, inactivo, suspenso)                        â”‚
â”œâ”€ ultima_sesion                                               â”‚
â”œâ”€ created_at, updated_at                                     â”‚
â””â”€ RLS: Usuario ve su propia data, admin ve todo              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  jovenes (JÃ³venes registrados)                              â”‚
â”œâ”€ id (PK)                                                    â”‚
â”œâ”€ nombre_completo                                             â”‚
â”œâ”€ fecha_nacimiento                                            â”‚
â”œâ”€ cedula (UNIQUE, 8-10 dÃ­gitos)                             â”‚
â”œâ”€ celular (Formato +57)                                      â”‚
â”œâ”€ grupo_id (FK to grupos)                                    â”‚
â”œâ”€ bautizado, sellado, servidor, simpatizante               â”‚
â”œâ”€ consentimientos (4 campos boolean)                         â”‚
â”œâ”€ estado (activo, inactivo, eliminado)                      â”‚
â”œâ”€ created_at, updated_at                                     â”‚
â””â”€ RLS: Joven ve su data, lider ve grupo, admin ve todo      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  grupos (Grupos de jÃ³venes)                                 â”‚
â”œâ”€ id (PK)                                                    â”‚
â”œâ”€ nombre                                                      â”‚
â”œâ”€ descripcion                                                 â”‚
â”œâ”€ lider_id (FK to users)                                     â”‚
â”œâ”€ fecha_creacion                                              â”‚
â”œâ”€ estado (activo, inactivo)                                  â”‚
â”œâ”€ created_at, updated_at                                     â”‚
â””â”€ RLS: Lider ve su grupo, admin ve todos                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  actividad_usuarios (AuditorÃ­a)                             â”‚
â”œâ”€ id (PK)                                                    â”‚
â”œâ”€ usuario_id (FK to users)                                   â”‚
â”œâ”€ accion (LOGIN, LOGOUT, CREATE, UPDATE, DELETE)           â”‚
â”œâ”€ tabla_afectada                                              â”‚
â”œâ”€ registro_id                                                 â”‚
â”œâ”€ detalles (JSON)                                             â”‚
â”œâ”€ ip_address                                                  â”‚
â”œâ”€ user_agent                                                  â”‚
â”œâ”€ created_at                                                  â”‚
â””â”€ RLS: Solo admin puede ver                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[+ 6 tablas mÃ¡s: mensajes_cumpleaÃ±os, plantillas_mensajes,
   versiculos, configuracion_sistema, historial_eliminaciones,
   notificaciones]
```

---

## ğŸ§ª Testing Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POSTMAN COLLECTION                                     â”‚
â”‚  â”œâ”€ Tests de endpoints sin auth                         â”‚
â”‚  â”œâ”€ Tests de endpoints con auth                         â”‚
â”‚  â”œâ”€ Tests de validaciones (errores esperados)           â”‚
â”‚  â””â”€ Variables de entorno automÃ¡ticas                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND TESTS                                         â”‚
â”‚  â”œâ”€ ValidaciÃ³n de formularios (Zod)                     â”‚
â”‚  â”œâ”€ Mock de API responses                               â”‚
â”‚  â”œâ”€ E2E tests (Cypress/Playwright)                      â”‚
â”‚  â””â”€ Unit tests (Jest/Vitest)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND TESTS                                          â”‚
â”‚  â”œâ”€ Integration tests                                   â”‚
â”‚  â”œâ”€ Edge Function logs                                  â”‚
â”‚  â”œâ”€ Database constraints                                â”‚
â”‚  â””â”€ AuditorÃ­a logs                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGING ENVIRONMENT                                    â”‚
â”‚  â”œâ”€ Replica de producciÃ³n                               â”‚
â”‚  â”œâ”€ Test con datos reales                               â”‚
â”‚  â””â”€ VerificaciÃ³n de performance                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRODUCTION                                             â”‚
â”‚  â”œâ”€ Deploy con CI/CD                                    â”‚
â”‚  â”œâ”€ Monitoring de logs                                  â”‚
â”‚  â”œâ”€ Performance monitoring                              â”‚
â”‚  â””â”€ Backup automÃ¡tico                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Escalabilidad

### Ahora (MVP)
```
- 1 Edge Function: auth
- 1 Database: PostgreSQL 14+
- Expected: 100-1,000 usuarios
- Capacity: âœ… Suficiente
```

### Futuro (Escala)
```
- MÃºltiples Edge Functions por dominio (auth, usuarios, reportes)
- Read replicas de BD
- CDN para assets estÃ¡ticos
- Redis cache (opcional)
- Message Queue (opcional)
- Expected: 10,000+ usuarios
- Capacity: âœ… Supabase auto-scales
```

---

## ğŸ’¾ Backups & Disaster Recovery

```
Supabase ofrece:
â”œâ”€ Backups automÃ¡ticos diarios
â”œâ”€ RetenciÃ³n de 7 dÃ­as
â”œâ”€ Point-in-time recovery
â”œâ”€ Disaster recovery plan
â””â”€ SLA 99.95% uptime
```

---

## ğŸš€ Deployment

### Fase Actual (MVP)
```
Frontend:  (pendiente)
Backend:   Supabase Edge Functions âœ… DEPLOYED
Database:  Supabase PostgreSQL âœ… DEPLOYED
```

### Antes de ProducciÃ³n
```
Checklist:
â–¡ HTTPS en todos los endpoints
â–¡ Rate limiting configurado
â–¡ CORS restrictivo (no *)
â–¡ Email service configurado
â–¡ Monitoring activo
â–¡ Backups verificados
â–¡ RLS policies revisadas
â–¡ Performance optimizado
â–¡ Tests pasando 100%
â–¡ DocumentaciÃ³n actualizada
```

---

## ğŸ“ Monitoreo & Logs

```
Ubicaciones de logs:
â”œâ”€ Edge Function logs  â†’ Supabase Dashboard â†’ Functions
â”œâ”€ Database logs       â†’ Supabase Dashboard â†’ Logs
â”œâ”€ Auth logs           â†’ Supabase Dashboard â†’ Auth
â”œâ”€ API logs            â†’ Edge Function output
â””â”€ Audit logs          â†’ Tabla actividad_usuarios
```

---

## ğŸ¯ MÃ©tricas Clave

```
SLA Targets:
â”œâ”€ API Response Time    < 200ms
â”œâ”€ Database Query       < 50ms
â”œâ”€ Uptime              > 99.95%
â”œâ”€ Error Rate          < 0.1%
â””â”€ User Satisfaction   > 4.5/5
```

---

**Diagrama actualizado**: 2026-01-19  
**VersiÃ³n**: 1.0  
**Status**: âœ… FASE 2 BACKEND IMPLEMENTADO SEGÃšN ARQUITECTURA
